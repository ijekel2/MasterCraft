@using MasterCraft.Client.Common.Api;
@using Microsoft.Extensions.Configuration

@implements IDisposable

@inject IJSRuntime JS
@inject ApiClient ApiClient
@inject IConfiguration Configuration
@inject NavigationManager Navigation

@VideoHtml
<SfButton id="btn-record" CssClass="mc-btn mc-btn-green">Record Video</SfButton>

<style>
    #btn-record{
        width: 140px;
    }
</style>

@code {
    MarkupString VideoHtml;
    DotNetObjectReference<Loom> ObjectReference;

    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();

        ApiResponse<AccessTokenVm> response = await ApiClient.GetAsync<AccessTokenVm>("loomtoken");

        ObjectReference = DotNetObjectReference.Create(this);
        await JS.InvokeVoidAsync("LoomService.init", new object [] { response?.Response.AccessToken, "btn-record", ObjectReference });
    }

    [JSInvokable]
    public void InsertVideoHtml(string html)
    {
        VideoHtml = (MarkupString)html;
        StateHasChanged();
    }

    public void Dispose()
    {
        ObjectReference?.Dispose();
    }
}
